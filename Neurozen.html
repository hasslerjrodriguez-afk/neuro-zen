import React, { useState, useEffect, useRef } from 'react';
import { 
  Activity, 
  Brain, 
  ShieldAlert, 
  Users, 
  Heart, 
  Coins, 
  Zap, 
  ArrowRight, 
  CheckCircle, 
  Terminal, 
  RefreshCcw, 
  AlertTriangle,
  Wind,
  Cpu,
  Lock,
  Search,
  Sparkles,
  Loader2,
  MessageSquare
} from 'lucide-react';

// --- API Configuration ---
const apiKey = ""; // System will inject the key at runtime

// --- Helper: Gemini API Call ---
const callGemini = async (prompt, systemInstruction = "") => {
  if (!apiKey) {
    console.error("API Key missing");
    return "ERROR: API Key not detected. Manual override required.";
  }

  try {
    const response = await fetch(
      `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`,
      {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          contents: [{ parts: [{ text: prompt }] }],
          systemInstruction: { parts: [{ text: systemInstruction }] },
        }),
      }
    );

    if (!response.ok) {
        const errorData = await response.json();
        throw new Error(errorData.error?.message || "Network response was not ok");
    }

    const data = await response.json();
    return data.candidates?.[0]?.content?.parts?.[0]?.text || "No data received.";
  } catch (error) {
    console.error("Gemini API Error:", error);
    return `SYSTEM FAILURE: ${error.message}. Please retry.`;
  }
};

// --- System Components ---

const Button = ({ children, onClick, variant = 'primary', className = '', disabled = false }) => {
  const baseStyle = "relative overflow-hidden font-mono text-sm uppercase tracking-wider py-3 px-6 transition-all duration-300 transform hover:scale-[1.02] active:scale-95 clip-path-polygon disabled:opacity-50 disabled:cursor-not-allowed";
  
  const variants = {
    primary: "bg-cyan-900/30 text-cyan-400 border border-cyan-500/50 hover:bg-cyan-500/20 hover:shadow-[0_0_15px_rgba(6,182,212,0.5)]",
    secondary: "bg-slate-800/50 text-slate-400 border border-slate-600 hover:bg-slate-700/50 hover:text-slate-200",
    danger: "bg-red-900/30 text-red-400 border border-red-500/50 hover:bg-red-500/20 hover:shadow-[0_0_15px_rgba(239,68,68,0.5)]",
    success: "bg-emerald-900/30 text-emerald-400 border border-emerald-500/50 hover:bg-emerald-500/20 hover:shadow-[0_0_15px_rgba(16,185,129,0.5)]",
    ai: "bg-purple-900/30 text-purple-300 border border-purple-500/50 hover:bg-purple-500/20 hover:shadow-[0_0_15px_rgba(168,85,247,0.5)]"
  };

  return (
    <button onClick={onClick} disabled={disabled} className={`${baseStyle} ${variants[variant]} ${className}`}>
      <span className="relative z-10 flex items-center justify-center gap-2">{children}</span>
    </button>
  );
};

const Card = ({ children, title, icon: Icon, className = "" }) => (
  <div className={`relative bg-slate-950/80 backdrop-blur-xl border border-slate-800 p-6 shadow-2xl ${className}`}>
    <div className="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-cyan-500 to-transparent opacity-50"></div>
    {(title || Icon) && (
      <div className="flex items-center gap-3 mb-6 pb-4 border-b border-slate-800">
        {Icon && <Icon className="w-5 h-5 text-cyan-500" />}
        {title && <h3 className="text-lg font-mono text-cyan-400 uppercase tracking-widest">{title}</h3>}
      </div>
    )}
    {children}
    {/* Decorative corner markers */}
    <div className="absolute top-0 left-0 w-2 h-2 border-t border-l border-cyan-500"></div>
    <div className="absolute top-0 right-0 w-2 h-2 border-t border-r border-cyan-500"></div>
    <div className="absolute bottom-0 left-0 w-2 h-2 border-b border-l border-cyan-500"></div>
    <div className="absolute bottom-0 right-0 w-2 h-2 border-b border-r border-cyan-500"></div>
  </div>
);

const TerminalOutput = ({ children, title = "SYSTEM OUTPUT" }) => (
    <div className="bg-black/80 border border-slate-800 rounded p-4 font-mono text-sm text-green-400/90 shadow-inner overflow-hidden relative mt-4">
        <div className="absolute top-0 right-0 px-2 py-1 bg-slate-800 text-[10px] text-slate-400 uppercase tracking-widest">{title}</div>
        <div className="mt-2 whitespace-pre-wrap leading-relaxed">
            {children}
        </div>
    </div>
);

const ProgressBar = ({ current, total }) => (
  <div className="w-full h-1 bg-slate-900 fixed top-0 left-0 z-50">
    <div 
      className="h-full bg-cyan-500 shadow-[0_0_10px_#06b6d4] transition-all duration-500 ease-out"
      style={{ width: `${(current / total) * 100}%` }}
    />
  </div>
);

// --- Protocol Data & Content ---

const PROTOCOLS = {
  PHYSICAL: {
    action: [
      "INITIATE: High-Intensity Interval Output (HIIT) - Clear cortisol.",
      "DIET: Remove inflammatory inputs. Focus: Lean protein, phytonutrients.",
      "SLEEP: Circadian synchronization. Dark room. 7.5h minimum.",
      "DEFENSE: Learn basic self-preservation combat mechanics."
    ],
    wisdom: "The biological vessel is transient. Optimization is duty, attachment is suffering. Execute detachment subroutines: Yoga, Prana, Meditation."
  },
  SOCIAL: {
    action: [
      "AUDIT: Identify high-value targets (integrity, growth-mindset).",
      "VALUE: You attract what you are. Increase internal asset value.",
      "LISTENING: Deploy active listening algorithms. 80/20 listen/speak ratio.",
      "GIVING: Offer value without immediate expectation of return."
    ],
    wisdom: "Social validation is an external dependency. It is inherently unstable. The only constant is the observer self. Rely on internal validation metrics."
  },
  MATE: {
    action: [
      "MARKET VALUE: Improve physical health, status signals, and emotional intelligence.",
      "LOCATION: Position self in environments with high-probability matches.",
      "SCREENING: Filter for shared core values, not just phenotype aesthetics.",
      "COMMUNICATION: Radical honesty protocol."
    ],
    wisdom: "A partner is a temporary traveler. Do not build your foundation on another's shifting soil. The deepest union is with the Self."
  },
  RESOURCES: {
    action: [
      "SKILL ACQUISITION: Identify market gaps. Learn rare, valuable skills.",
      "LEVERAGE: Utilize code, media, or capital to multiply output.",
      "AUSTERITY: Reduce overhead. Increase investable surplus.",
      "SALES: Master the psychology of value transfer."
    ],
    wisdom: "Wealth is a tool, not a destination. Millions without meaning is high-bandwidth misery. Locate the mission, not just the currency."
  }
};

const BREATHING_EXERCISE = () => {
  const [phase, setPhase] = useState('Inhale');
  const [count, setCount] = useState(4);

  useEffect(() => {
    const timer = setInterval(() => {
      setCount((c) => {
        if (c === 1) {
          if (phase === 'Inhale') { setPhase('Hold'); return 4; }
          if (phase === 'Hold') { setPhase('Exhale'); return 4; }
          if (phase === 'Exhale') { setPhase('Inhale'); return 4; }
        }
        return c - 1;
      });
    }, 1000);
    return () => clearInterval(timer);
  }, [phase]);

  return (
    <div className="flex flex-col items-center justify-center p-8 bg-slate-900/50 rounded-lg border border-cyan-500/20">
      <div className={`text-4xl font-mono font-bold mb-4 transition-colors duration-500 ${
        phase === 'Inhale' ? 'text-cyan-400' : phase === 'Hold' ? 'text-purple-400' : 'text-emerald-400'
      }`}>
        {phase}
      </div>
      <div className="text-6xl font-bold text-white mb-6">{count}</div>
      <div className="text-xs text-slate-500 uppercase tracking-widest">Bio-Regulation Active</div>
    </div>
  );
};

// --- Main Application ---

export default function LifeOS() {
  const [step, setStep] = useState(0);
  const [problem, setProblem] = useState('');
  const [threatType, setThreatType] = useState(null); // physical, social, mate, resources
  
  // AI State
  const [isAiLoading, setIsAiLoading] = useState(false);
  const [aiAnalysis, setAiAnalysis] = useState(null); // Step 1 analysis
  const [aiTactics, setAiTactics] = useState(null); // Step 5 action
  const [aiWisdom, setAiWisdom] = useState(null); // Step 5 wisdom

  // Scroll to top on step change
  useEffect(() => {
    window.scrollTo(0, 0);
  }, [step]);

  const handleRestart = () => {
    setStep(0);
    setProblem('');
    setThreatType(null);
    setAiAnalysis(null);
    setAiTactics(null);
    setAiWisdom(null);
  };

  // --- AI Handlers ---

  const runDeepScan = async () => {
    if (!problem.trim()) return;
    setIsAiLoading(true);
    const systemPrompt = "You are LIFE_OS, an advanced biological optimization AI. Analyze inputs coldly and scientifically. Be concise.";
    const userPrompt = `Input disturbance: "${problem}". 
    1. Is this a 'LETHAL' survival threat (gun to head/starvation) or 'PSYCHOLOGICAL' noise? 
    2. Which of these 4 sectors does it best fit: Physical, Social, Mate, Resources?
    Format response as:
    THREAT_LEVEL: [Lethal/Psychological]
    SECTOR: [Sector Name]
    BRIEF_ANALYSIS: [One sentence scientific observation]`;
    
    const result = await callGemini(userPrompt, systemPrompt);
    setAiAnalysis(result);
    setIsAiLoading(false);
  };

  const generateTactics = async () => {
    setIsAiLoading(true);
    const systemPrompt = "You are a tactical operations commander AI. Give imperative, military-style commands.";
    const userPrompt = `User has a ${threatType} problem: "${problem}".
    Generate a strict, 4-step tactical protocol to solve this specific problem.
    Format as a numbered list. Use cold, efficient language. No fluff.`;
    
    const result = await callGemini(userPrompt, systemPrompt);
    setAiTactics(result);
    setIsAiLoading(false);
  };

  const generateWisdom = async () => {
    setIsAiLoading(true);
    const systemPrompt = "You are a cyber-monk AI. You blend Stoicism, Buddhism, and Tech metaphors.";
    const userPrompt = `User is suffering from: "${problem}" in the ${threatType} sector.
    Generate a short, profound philosophical reframe to help them detach. 
    Explain why this problem is temporary and how to find the 'Self' amidst it.`;
    
    const result = await callGemini(userPrompt, systemPrompt);
    setAiWisdom(result);
    setIsAiLoading(false);
  };

  const renderView = () => {
    switch (step) {
      case 0: // Intro
        return (
          <div className="flex flex-col items-center justify-center h-[80vh] text-center space-y-8 animate-fadeIn">
            <div className="relative">
              <div className="absolute inset-0 bg-cyan-500 blur-3xl opacity-20"></div>
              <Cpu className="w-24 h-24 text-cyan-400 relative z-10 animate-pulse" />
            </div>
            <h1 className="text-5xl md:text-7xl font-bold tracking-tighter text-white">
              LIFE<span className="text-cyan-500">_OS</span>
            </h1>
            <p className="text-slate-400 max-w-md text-lg font-mono">
              Algorithmic guidance for biological entities. 
              Analyze. Optimize. Transcend.
            </p>
            <Button onClick={() => setStep(1)} className="mt-8">
              Initialize System <Terminal className="w-4 h-4" />
            </Button>
          </div>
        );

      case 1: // Define Problem
        return (
          <div className="max-w-2xl mx-auto space-y-6 animate-slideUp">
            <Card title="Input Parameter" icon={Activity}>
              <label className="block text-sm text-slate-400 mb-2 font-mono">Define the disturbance:</label>
              <textarea 
                value={problem}
                onChange={(e) => setProblem(e.target.value)}
                className="w-full bg-slate-900 border border-slate-700 p-4 text-cyan-50 text-lg rounded focus:border-cyan-500 focus:outline-none focus:ring-1 focus:ring-cyan-500 transition-all h-32 resize-none"
                placeholder="Ex: Anxiety about losing my job..."
              />
              
              {/* AI Integration Area */}
              <div className="mt-4 flex flex-col gap-4">
                 {!aiAnalysis && (
                    <div className="flex justify-between items-center">
                        <span className="text-xs text-slate-500 font-mono">Optional: Run AI diagnostics before proceeding</span>
                        <Button 
                            variant="ai" 
                            onClick={runDeepScan} 
                            disabled={!problem.trim() || isAiLoading}
                            className="py-2 px-4 text-xs"
                        >
                            {isAiLoading ? <Loader2 className="w-4 h-4 animate-spin" /> : <><Sparkles className="w-4 h-4" /> Deep Scan Analysis</>}
                        </Button>
                    </div>
                 )}

                 {aiAnalysis && (
                     <div className="animate-fadeIn">
                        <TerminalOutput title="AI DIAGNOSTIC REPORT">
                            {aiAnalysis}
                        </TerminalOutput>
                     </div>
                 )}
              </div>
            </Card>
            <div className="flex justify-end">
              <Button onClick={() => problem.trim() && setStep(2)} disabled={!problem.trim()}>
                Proceed <ArrowRight className="w-4 h-4" />
              </Button>
            </div>
          </div>
        );

      case 2: // Immediate Relief Check
        return (
          <div className="max-w-2xl mx-auto space-y-6 animate-slideUp">
             <Card title="System Diagnostics" icon={Activity}>
              <p className="text-xl text-white mb-8">
                Is your biological stress level critically high? 
                <span className="block text-sm text-slate-400 mt-2">(Heart rate elevated, panic, inability to think logically)</span>
              </p>
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                <Button variant="danger" onClick={() => setStep(2.5)}>
                  YES - CRITICAL
                </Button>
                <Button variant="primary" onClick={() => setStep(3)}>
                  NO - STABLE
                </Button>
              </div>
            </Card>
          </div>
        );

      case 2.5: // Immediate Relief Protocol
        return (
          <div className="max-w-2xl mx-auto space-y-6 animate-slideUp">
            <Card title="Emergency Regulation Protocol" icon={Wind}>
              <p className="text-slate-300 mb-6">
                Cognitive functions compromised. Engaging parasympathetic override.
              </p>
              <BREATHING_EXERCISE />
              <div className="mt-8 p-4 bg-slate-900/50 border-l-2 border-cyan-500 text-sm text-slate-300 font-mono">
                INSTRUCTION: Perform Yoga Nidra or Box Breathing until heart rate variability stabilizes.
              </div>
            </Card>
            <div className="flex justify-center">
              <Button variant="success" onClick={() => setStep(3)}>
                System Stabilized <CheckCircle className="w-4 h-4" />
              </Button>
            </div>
          </div>
        );

      case 3: // Root Analysis
        return (
          <div className="max-w-2xl mx-auto space-y-6 animate-slideUp">
            <Card title="Deep Scan Analysis" icon={Search}>
              <div className="flex items-center gap-4 mb-6">
                <div className="w-16 h-16 bg-slate-900 rounded-full flex items-center justify-center border border-slate-700">
                  <Brain className="w-8 h-8 text-cyan-500" />
                </div>
                <div>
                  <h4 className="text-white font-bold">Root Cause Identification</h4>
                  <p className="text-slate-400 text-sm">Processing input: "{problem}"</p>
                </div>
              </div>
              <div className="space-y-4">
                <p className="text-lg text-slate-200">
                  Is this a <span className="text-red-400 font-bold">REAL THREAT</span> to your immediate survival?
                </p>
                <p className="text-sm text-slate-400">
                  Definition: A gun to the head, a tiger in the room, starvation imminent within 24h.
                </p>
                {aiAnalysis && (
                    <div className="mt-4 p-3 border border-purple-500/30 bg-purple-900/10 rounded">
                        <p className="text-xs text-purple-400 font-mono mb-1">AI INSIGHT:</p>
                        <p className="text-sm text-purple-200 italic opacity-80 line-clamp-3">{aiAnalysis}</p>
                    </div>
                )}
              </div>
            </Card>
            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
              <Button variant="danger" onClick={() => setStep(4)}>
                YES - LETHAL THREAT
              </Button>
              <Button variant="primary" onClick={() => setStep(3.5)}>
                NO - PSYCHOLOGICAL THREAT
              </Button>
            </div>
          </div>
        );

      case 3.5: // Not Real Threat Loop
        return (
          <div className="max-w-2xl mx-auto space-y-6 animate-slideUp">
            <Card title="Perception Error Detected" icon={ShieldAlert}>
              <div className="border-l-4 border-emerald-500 pl-6 py-2">
                <h2 className="text-2xl text-white font-bold mb-2">You Will Not Die.</h2>
                <p className="text-slate-300">
                  The amygdala has fired a false positive. This is a simulation of danger, not danger itself.
                </p>
              </div>
              <div className="mt-6 space-y-2 font-mono text-sm text-cyan-400/80">
                <p>{'>'} Re-calibrating threat assessment...</p>
                <p>{'>'} Mortality probability: 0.00%</p>
                <p>{'>'} Solution existence: 100%</p>
              </div>
            </Card>
            <Button className="w-full" onClick={() => setStep(4)}>
              Proceed to Categorization <ArrowRight className="w-4 h-4" />
            </Button>
          </div>
        );

      case 4: // Categorize
        return (
          <div className="max-w-3xl mx-auto space-y-6 animate-slideUp">
            <h2 className="text-2xl text-white font-mono text-center mb-8">LOCATE DISTURBANCE SECTOR</h2>
            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
              <button onClick={() => { setThreatType('PHYSICAL'); setStep(5); }} className="group">
                <Card className="h-full hover:bg-slate-900 transition-colors" title="Physical / Safety" icon={Heart}>
                  <p className="text-slate-400 text-sm">Health issues, physical violence, bodily integrity, housing safety.</p>
                </Card>
              </button>
              <button onClick={() => { setThreatType('SOCIAL'); setStep(5); }} className="group">
                <Card className="h-full hover:bg-slate-900 transition-colors" title="Social / Status" icon={Users}>
                  <p className="text-slate-400 text-sm">Friendship, reputation, loneliness, tribal belonging, rejection.</p>
                </Card>
              </button>
              <button onClick={() => { setThreatType('MATE'); setStep(5); }} className="group">
                <Card className="h-full hover:bg-slate-900 transition-colors" title="Mating / Partner" icon={Zap}>
                  <p className="text-slate-400 text-sm">Relationships, breakups, finding a partner, reproduction urgency.</p>
                </Card>
              </button>
              <button onClick={() => { setThreatType('RESOURCES'); setStep(5); }} className="group">
                <Card className="h-full hover:bg-slate-900 transition-colors" title="Resources / Career" icon={Coins}>
                  <p className="text-slate-400 text-sm">Money, job loss, career path, assets, poverty fear.</p>
                </Card>
              </button>
            </div>
          </div>
        );

      case 5: // The Fork (Action vs Wisdom)
        const currentProtocol = PROTOCOLS[threatType];
        return (
          <div className="max-w-4xl mx-auto space-y-8 animate-slideUp">
            <div className="text-center">
              <h2 className="text-3xl font-bold text-white mb-2">SECTOR: {threatType}</h2>
              <p className="text-slate-400">Two paths available. Select protocol.</p>
            </div>

            <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
              {/* Path A: Action */}
              <div className="flex flex-col">
                <Card className="flex-1 border-t-4 border-t-cyan-500 mb-4" title="Path A: Optimization" icon={Cpu}>
                  <p className="text-slate-300 mb-4">
                    Execute high-level algorithms to solve the external problem. Master the game.
                  </p>
                  {threatType === 'PHYSICAL' && <p className="text-red-400 text-sm font-bold animate-pulse mb-4">IMMEDIATE: RUN / ESCAPE THREAT FIRST.</p>}
                  
                  {/* Standard Protocols */}
                  {!aiTactics && (
                    <ul className="space-y-3 mb-6">
                        {currentProtocol.action.map((item, i) => (
                        <li key={i} className="flex items-start gap-2 text-sm text-cyan-100/80 font-mono">
                            <span className="text-cyan-500 mt-1">_</span>
                            {item}
                        </li>
                        ))}
                    </ul>
                  )}

                  {/* AI Generated Tactics */}
                  {aiTactics && (
                      <TerminalOutput title="AI GENERATED TACTICS">
                          {aiTactics}
                      </TerminalOutput>
                  )}

                  {/* Generator Button */}
                  <div className="mt-4 border-t border-slate-800 pt-4">
                      <Button 
                        variant="ai" 
                        className="w-full text-xs" 
                        onClick={generateTactics}
                        disabled={isAiLoading}
                      >
                         {isAiLoading && !aiWisdom ? <Loader2 className="w-4 h-4 animate-spin" /> : <><Sparkles className="w-4 h-4" /> Generate Custom Protocol</>}
                      </Button>
                  </div>
                </Card>
                <Button onClick={() => setStep(6)}>
                  Acknowledge & Proceed
                </Button>
              </div>

              {/* Path B: Wisdom */}
              <div className="flex flex-col">
                <Card className="flex-1 border-t-4 border-t-purple-500 mb-4" title="Path B: Transcendence" icon={Brain}>
                  <p className="text-slate-300 mb-6">
                    Realize the impermanence of the problem. Detach from the outcome.
                  </p>
                  
                  {/* Standard Wisdom */}
                  {!aiWisdom && (
                    <div className="bg-slate-900/50 p-6 border border-purple-500/20 rounded relative overflow-hidden">
                        <div className="absolute top-0 right-0 p-2 opacity-10">
                        <Lock className="w-12 h-12 text-white" />
                        </div>
                        <p className="text-purple-200 italic font-serif leading-relaxed text-lg">
                        "{currentProtocol.wisdom}"
                        </p>
                    </div>
                  )}

                  {/* AI Generated Wisdom */}
                  {aiWisdom && (
                    <TerminalOutput title="COGNITIVE REFRAME">
                        {aiWisdom}
                    </TerminalOutput>
                  )}

                  {/* Generator Button */}
                  <div className="mt-4 border-t border-slate-800 pt-4">
                      <Button 
                        variant="ai" 
                        className="w-full text-xs" 
                        onClick={generateWisdom}
                        disabled={isAiLoading}
                      >
                         {isAiLoading && !aiTactics ? <Loader2 className="w-4 h-4 animate-spin" /> : <><Sparkles className="w-4 h-4" /> Synthesize Stoic Reframe</>}
                      </Button>
                  </div>
                </Card>
                 <Button variant="secondary" onClick={() => setStep(6)}>
                  Internalize Truth
                </Button>
              </div>
            </div>
          </div>
        );

      case 6: // Meaning (The Final Step)
        return (
          <div className="max-w-2xl mx-auto space-y-8 animate-slideUp">
            <Card title="Final Core Directive: MEANING" icon={Lock}>
              <div className="space-y-6 text-slate-300">
                <p className="text-lg">
                  Whether you optimize the body, gather the tribe, secure the mate, or amass the gold... the system remains incomplete without <span className="text-cyan-400 font-bold">MEANING</span>.
                </p>
                
                <div className="bg-slate-900 p-6 border border-slate-700">
                  <h4 className="text-cyan-500 font-mono mb-4 text-sm uppercase">Search Algorithm for Meaning:</h4>
                  <ul className="space-y-4">
                    <li className="flex gap-3">
                      <div className="w-6 h-6 rounded bg-cyan-900/50 flex items-center justify-center text-cyan-400 text-xs font-mono">1</div>
                      <p>Responsibility: Meaning is found in the weight you voluntarily carry.</p>
                    </li>
                    <li className="flex gap-3">
                      <div className="w-6 h-6 rounded bg-cyan-900/50 flex items-center justify-center text-cyan-400 text-xs font-mono">2</div>
                      <p>Contribution: How does your existence benefit the collective grid?</p>
                    </li>
                    <li className="flex gap-3">
                      <div className="w-6 h-6 rounded bg-cyan-900/50 flex items-center justify-center text-cyan-400 text-xs font-mono">3</div>
                      <p>Self-Transcendence: The deepest need is not to have, but to become.</p>
                    </li>
                  </ul>
                </div>
              </div>
            </Card>

            <div className="flex flex-col gap-4 text-center">
              <p className="text-slate-500 text-sm font-mono">SESSION COMPLETE</p>
              <Button variant="success" onClick={handleRestart}>
                <RefreshCcw className="w-4 h-4" /> Reboot System
              </Button>
            </div>
          </div>
        );

      default:
        return null;
    }
  };

  return (
    <div className="min-h-screen bg-slate-950 text-slate-200 font-sans selection:bg-cyan-500/30 selection:text-cyan-200 overflow-x-hidden pb-12">
      <style>{`
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fadeIn { animation: fadeIn 0.8s ease-out forwards; }
        .animate-slideUp { animation: slideUp 0.6s ease-out forwards; }
        .clip-path-polygon { clip-path: polygon(10px 0, 100% 0, 100% calc(100% - 10px), calc(100% - 10px) 100%, 0 100%, 0 10px); }
      `}</style>
      
      {/* HUD Header */}
      <header className="fixed top-0 w-full z-40 bg-slate-950/80 backdrop-blur-md border-b border-slate-800 h-16 flex items-center justify-between px-6">
        <div className="flex items-center gap-2">
          <Activity className="w-5 h-5 text-cyan-500 animate-pulse" />
          <span className="font-mono font-bold text-slate-300 tracking-wider hidden sm:block">LIFE_OS v2.0</span>
        </div>
        <div className="flex items-center gap-4">
          <div className="hidden sm:flex flex-col items-end">
            <span className="text-xs text-slate-500 font-mono">SYS_STATUS</span>
            <span className="text-xs text-emerald-500 font-mono">ONLINE</span>
          </div>
        </div>
      </header>

      {/* Progress Line */}
      <ProgressBar current={step} total={6} />

      {/* Main Content Area */}
      <main className="pt-28 px-4 md:px-8 container mx-auto">
        {renderView()}
      </main>
      
      {/* Decorative Grid Background */}
      <div className="fixed inset-0 pointer-events-none z-[-1] opacity-20" 
           style={{ backgroundImage: 'linear-gradient(rgba(6,182,212,0.1) 1px, transparent 1px), linear-gradient(90deg, rgba(6,182,212,0.1) 1px, transparent 1px)', backgroundSize: '40px 40px' }}>
      </div>
    </div>
  );
}